(function(a){a.fn.truncate=function(b){var c={limit:140,indicator:"characters_remaining"};var b=a.extend(c,b);return this.each(function(){function d(a){function b(b){element_id=a.attr(b);e.push(element_id);element_id="["+b+"="+element_id;e.push(element_id)}var c="id";var d="class";var e=[];var f=typeof a.attr("id")!="undefined";var g=typeof a.attr("class")!="undefined";if(g&&f||f){b(c);var h=c}else{if(typeof a.attr(d)!="undefined"){b(d);var h=d}}e.push(h);return e}function j(){var b=a(e[1]+"]").val().length;if(i-b<=1){var c="character"}else{c="characters"}a("p[id="+g+"]").html(i-b+" "+c+" left.")}function k(){setTimeout(function(){if(a(e[1]+"]").val().length>i){trimmed=a(e[1]+"]").val().substr(0,i);a(e[1]+"]").val(trimmed)}},10);setTimeout(function(){j()},20)}function l(b,c){if(a(e[1]+"]").getSelection().text==""&&a(e[1]+"]").val().length>=i){if((c.which===86||c.which==118)&&c.ctrlKey){c.preventDefault()}else{if(c.which==116||c.which==0||c.which==33||c.which==34||c.which==35||c.which==36||c.which==37||c.which==38||c.which==39||c.which==40||c.which==8){c}else{if(c.ctrlKey==false){c.preventDefault()}}}}k()}var c=a(this).get(0).tagName.toLowerCase();a(this).val("");var e=d(a(this));var f=b.limit;var g=b.indicator;a("textarea["+e[2]+"="+e[0]+"]").after("<p id="+g+">"+f+" characters left.</p>");var h={getSelection:function(){var a=this.jquery?this[0]:this;return("selectionStart"in a&&function(){var b=a.selectionEnd-a.selectionStart;return{start:a.selectionStart,end:a.selectionEnd,length:b,text:a.value.substr(a.selectionStart,b)}}||document.selection&&function(){a.focus();var b=document.selection.createRange();if(b===null){return{start:0,end:a.value.length,length:0}}var c=a.createTextRange();var d=c.duplicate();c.moveToBookmark(b.getBookmark());d.setEndPoint("EndToStart",c);return{start:d.text.length,end:d.text.length+b.text.length,length:b.text.length,text:b.text}}||function(){return null})()}};jQuery.each(h,function(a){jQuery.fn[a]=this});var i=f;a(e[1]+"]").bind("input propertychange",function(a){l(e[1],a)});a(e[1]+"]").bind("keypress keydown",function(a){l(e[1],a)});a(e[1]+"]").on("paste",function(b){if(a(e[1]+"]").getSelection().text==""&&a(e[1]+"]").val().length>=i){b.preventDefault()}k()})})}})(jQuery)