(function(e,t,n,r){"use strict";var i="stopVerbosity";var s=function(t,r){var i={limit:10,indicatorPosition:"after",indicatorId:"",indicatorElementType:"p",indicatorPhrase:["Used","[countup]","of","[limit]","characters.","[countdown]","characters remaining.","The maximum is","[limit]","characters.","<br>","Permits multiple counts up:","[countup]","and counts down:","[countdown].","This indicator is customizable."],indicatorUpdateSpeed:0,existingIndicator:"",generateIndicator:true,showIndicator:true,useNativeMaxlength:true,textLengthChange:false,useMaxlength:true,beforeAttachment:null,afterAttachment:null};var s=function(t,n){s.element=t;s.options=e.extend({},i,n)};var o=s.prototype={init:function(){var n=e(t);var r=o.setupActions().init(n,s.options);o.eventsActions(n).init(s.options.limit,r)},setupActions:function(){var e=function(){};e.prototype={init:function(t,n){try{if(Object.prototype.toString.call(n.beforeAttachment)==="[object Function]"){n.beforeAttachment.call(t)}}catch(r){throw"beforeAttachment is not a proper function."}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e,t){if(this==null){throw new TypeError}var n=Object(this);var r=n.length>>>0;if(r===0){return-1}var i=0;if(arguments.length>1){i=Number(arguments[1]);if(i!=i){i=0}else if(i!=0&&i!=Infinity&&i!=-Infinity){i=(i>0||-1)*Math.floor(Math.abs(i))}}if(i>=r){return-1}var s=i>=0?i:Math.max(r-Math.abs(i),0);for(;s<r;s++){if(s in n&&n[s]===e){return s}}return-1}}t.val("");var i=n.limit,s=n.indicatorPosition,o=n.indicatorId,u=n.indicatorElementType,a=n.indicatorPhrase,f=n.existingIndicator,l=n.generateIndicator,c=n.showIndicator,h=n.useNativeMaxlength;var p=e.prototype,d=p.setupDataStore;d.useNativeMaxlength=h;d.indicatorUpdateSpeed=n.indicatorUpdateSpeed;d.textLengthChange=n.textLengthChange;d.useMaxlength=n.useMaxlength;d.showIndicator=c;d.afterAttachment=n.afterAttachment;p.checkLimitOption(i);p.setIndicator(i,u,o,s,a,t,f,l,c);return p.setupDataStore},checkLimitOption:function(e){if(!(typeof e==="number"&&parseFloat(e)==parseInt(e,10)&&!isNaN(e)&&e>0)){throw"Text limit is not a valid positive integer."}},setIndicator:function(e,t,n,r,i,s,o,u,a){function l(t,n,r){for(var i=0,s=t.length;i<s;i++){var o=t[i],u=o.length,a="["+o+"]",f="\\["+o+"\\]",l=o+"Coupled",c=0,h=n.length,p=new RegExp(f);l=r.setupDataStore[l]={};for(;c<h;c++){var d=n[c];if(d===a){r.setupDataStore[o].push(c)}else if(p.test(d)){var v=d.indexOf(a),m=[];m.push(v);while(v>-1){v=d.indexOf(a,v+1);if(v>-1){m.push(v)}}if(m.length===1){var g=l[c]={};var y=p.exec(d).index;var b=d.slice(0,y),w=y+u+2,E=d.length,S=d.slice(w,E);switch(o){case"limit":case"countdown":n[c]=b+e+S;break;case"countup":n[c]=b+"0"+S;break}var x=E-w;g.firstEnd=y;g.backDifference=x}}}}}function c(e,t,n,r){for(var i=0,s=e.length;i<s;i++){var o=e[i],u=r.setupDataStore[o],a=u.length,f=0;for(;f<a;f++){var l=u[f];switch(o){case"countup":n[l]=0;break;default:t.phrase[l]=t.limit;break}}}}if(!a){return}var f=this;l(["limit","countup","countdown"],i,f);var h={phrase:i,limit:e};c(["limit","countdown","countup"],h,i,f);this.setupDataStore.indicatorPhrase=i;if(Object.prototype.toString.call(o)==="[object Object]"){try{if(o instanceof jQuery){this.setupDataStore.indicatorElement=o;o.html(i.join(" "));u=false}}catch(p){throw"Not a jQuery Object."}}if(u){var d=n.length>0?" id="+n:"";var v=["<",t,d,">",i.join(" "),"</",t,">"].join(""),m=["Not a valid position for indicator,","only accepts ","'before'"," or ","'after'"].join("");if(r==="after"){s.after(v);this.setupDataStore.indicatorElement=s.next()}else if(r==="before"){s.before(v);this.setupDataStore.indicatorElement=s.prev()}else{throw m}}},setupDataStore:{limit:[],countup:[],countdown:[]}};return e.prototype},eventsActions:function(t){var r=function(){},i=r.prototype={init:function(e,t){i.addListeners(e,t)},addListeners:function(e,r){var o=this.dataStore;o.limit=e;o.indicator=r;var u=r.indicatorUpdateSpeed;var a={preventFunction:function(){if(o.eventPrevent===null&&!o.isTextSelected){i.setDataStore("eventPrevent","keydown");i.removeDataStore("eventPresent");t.off("keydown");i.keydownFunction.keydownPrevent();i.pastePreventFunction()}},allowFunction:function(){if(o.eventPrevent!==null){i.removeDataStore("eventPrevent");i.setDataStore("eventPresent","keydown");t.off("keydown").off("paste");i.keydownFunction.keydown()}},changeText:function(t){var n=o.indicator,r=0,s=t.length;for(;r<s;r++){var a=t[r],f=n[a];if(typeof f!=="undefined"){var l=Object.prototype.toString.call(f);if(l==="[object Object]"){for(var c in f){if(f.hasOwnProperty(c)){var h=n.indicatorPhrase[c],p=h.length,d=f[c];var v=h.slice(0,d.firstEnd),m=p-d.backDifference,g=d.backDifference+p,y=h.slice(m,g);var b;if(a==="countdownCoupled"){w=e-i.getTextAreaLength();b=v+w+y}else if(a==="countupCoupled"){w=i.getTextAreaLength();b=v+w+y}n.indicatorPhrase[c]=b}}}else if(l==="[object Array]"){var w;if(a==="countdown"){w=e-i.getTextAreaLength()}else if(a==="countup"){w=i.getTextAreaLength()}var E=n[a],S=E.length,x=0;for(;x<S;x++){n.indicatorPhrase[E[x]]=w}}}}if(u>0){setTimeout(function(){n.indicatorElement.html(n.indicatorPhrase.join(" "))},u)}else{n.indicatorElement.html(n.indicatorPhrase.join(" "))}},textLengthChange:function(n){if(r.textLengthChange){var s=i.getTextAreaLength();if(s!==n){f.currentTextLength=s;f.lastTextLength=n;if(s<e){f.isLimitReached=false;f.exceededLimit=false}else if(s===e){f.isLimitReached=true;f.exceededLimit=false}else if(s>e){f.isLimitReached=true;f.exceededLimit=true}t.trigger("sv-textLengthChange",f)}}}};var f=a.textLengthChange.obj={};f.element=s.element;if(o.indicator.indicatorElement){f.indicatorElement=o.indicator.indicatorElement}var l=n.createElement("textarea"),c;if("oninput"in l){o.partialInputSupport=true;if(!("documentMode"in n)||n.documentMode>9){c=false;o.supportsInput=true;o.partialInputSupport=false}}else if("onpropertychange"in l){c=true;o.supportsInput=false}o.checkFirstKeyDown=c;if(!!("maxLength"in l)){if(r.useNativeMaxlength&&r.useMaxlength){t.attr("maxlength",e)}}i.setInputSelection.offsetToRangeCharacterMove=function(e,t){return t-(e.value.slice(0,t).split("\r\n").length-1)};i.deselectFunction(a);i.selectFunction(a);i.dropFunction();i.inputFunction(a);i.trackSelectionEventsFunction();i.mousedownFunction();i.clickFunction();i.keydownFunction();try{if(Object.prototype.toString.call(r.afterAttachment)==="[object Function]"){r.afterAttachment.call(t,f)}}catch(h){throw"afterAttachment is not a proper function."}},inputFunction:function(r){var s=i.dataStore,o=["countdown","countup","countdownCoupled","countupCoupled"],u={};var a=function(){if(s.indicator.showIndicator){r.changeText(o);i.copyObjectValue(s,u,"lengthText");i.setDataStore("lengthText",i.getTextAreaLength());r.textLengthChange(u.lengthText)}else{i.setDataStore("lengthText",i.getTextAreaLength())}};t.on("input propertychange",function(){s.checkFirstKeyDown=false;if(i.dataStore.dropOccurred){i.dataStore.dropOccurred=false;return}var e=s.limit,n=i.checkLimit(e);i.setDataStore("textStatus",n);if(n==="less"){if(s.falsePositive){r.allowFunction()}a();setTimeout(function(){i.trackSelectionFunction()})}else if(n==="equal"){if(s.falsePositive){if(s.indicator.useMaxlength){r.preventFunction()}}a();setTimeout(function(){i.trackSelectionFunction();if(s.falsePositive){if(typeof i.dataStore.newCaretPos==="number"){var e=i.dataStore.newCaretPos;i.setInputSelection(e,e);i.dataStore.newCaretPos=null}}})}else if(n==="greater"){s.falsePositive=true;if(s.selectBeforeKeydown){s.caretStatus=s.selectCaretStatus}if(s.indicator.useMaxlength){var o=i.getTextAreaLength(),u=s.caretStatus,f=u.start,l=u.end,c=s.lengthText,h=e-c,p=i.getText();var d,v,m,g;if(s.isTextSelected||s.selectBeforeKeydown){d=u.end;m=u.end;g=h+l;v=o-(c-l)}else{d=f;m=f;g=h+f;v=o-(c-f)}var y=p.slice(0,d),b=p.slice(m,g),w=p.slice(v,o),E=y+b+w,S=y.length+b.length;s.newCaretPos=S;if(E.length<=e){t.val(E);t.trigger("propertychange")}}else{a()}}});if(s.partialInputSupport){e(n).on("selectionchange",function(){if(i.getTextAreaLength()<s.lengthText){t.trigger("propertychange")}})}},dropFunction:function(){var e=i.dataStore;t.on("drop",function(){i.dataStore.dropOccurred=true;setTimeout(function(){i.trackSelectionFunction();var n=e.caretStatus,r=n.start,s=n.end,o;if(r!==s){e.caretStatus.start=r;e.caretStatus.end=r;o=s}else{var u=e.lengthText,a=t.val().length-u,f=r-a;e.caretStatus.start=f;e.caretStatus.end=f;o=r}i.setInputSelection(o,o);i.dataStore.dropOccurred=false;t.trigger("input")})})},pastePreventFunction:function(){t.on("paste",function(e){i.negateEvent(e)})},deselectFunction:function(e){t.on("stopVerbosity-deselect",function(){var n=i.dataStore.limit,r=i.checkLimit(n);i.trackSelectionFunction();if(r==="equal"){if(i.dataStore.indicator.useMaxlength){e.preventFunction()}}else if(r==="greater"){t.trigger("propertychange")}})},selectFunction:function(e){t.on("select",function(){if(i.dataStore.dropOccurred){return}i.trackSelectionFunction();var t=i.dataStore.caretStatus,n=i.dataStore.limit,r=i.checkLimit(n);var s=t.start,o=t.end,u=i.dataStore.selectCaretStatus;u.start=s;u.end=o;if(r==="equal"){if(t.end===t.start){if(i.dataStore.indicator.useMaxlength){e.preventFunction()}}else{e.allowFunction()}}})},trackSelectionEventsFunction:function(){t.on("mouseout focus blur keyup",function(){setTimeout(function(){i.trackSelectionFunction()})})},mousedownFunction:function(){t.on("mousedown",function(){i.setDataStore("isMouseDown",true)})},clickFunction:function(){t.on("click",function(){setTimeout(function(){i.trackSelectionFunction()});i.setDataStore("isMouseDown",false)})},keydownFunction:function(){var e=i.dataStore;this.keydownFunction.checkFirstKeyDown=function(n){if(e.checkFirstKeyDown){if(e.continueKeyCheck){setTimeout(function(){if(i.getTextAreaLength()>0){t.trigger("propertychange")}})}}if(n==="keyprevent"){setTimeout(function(){t.trigger("propertychange")})}};this.keydownFunction.checkTab=function(e){if(e.which===9){if(i.dataStore.isMouseDown){i.negateEvent(e);return true}}};this.keydownFunction.keydownPrevent=function(){t.on("keydown",function(t){if(/^(0|8|9|16|17|18|19|20|27|33|34|35|36|37|38|38|39|40|45|46|112|113|114|115|116|117|118|119|120|121|122|123)$/.test(t.which)){i.keydownFunction.checkTab(t);i.keydownFunction.checkFirstKeyDown("keyprevent");e.falsePositive=true}else if(t.ctrlKey===false){t.preventDefault()}setTimeout(function(){i.trackSelectionFunction();if(i.dataStore.isTextSelected){i.dataStore.selectBeforeKeydown=true}else{i.dataStore.selectBeforeKeydown=false}})})};t.off("keydown");this.keydownFunction.keydown=function(){t.on("keydown",function(e){i.keydownFunction.checkTab(e);i.keydownFunction.checkFirstKeyDown();setTimeout(function(){i.trackSelectionFunction();if(i.dataStore.isTextSelected){i.dataStore.selectBeforeKeydown=true}else{i.dataStore.selectBeforeKeydown=false}})})};this.keydownFunction.keydown()},dataStore:{newCaretPos:null,caretStatus:{start:0,end:0},selectCaretStatus:{start:0,end:0},dropOccurred:false,isMouseDown:false,isTextSelected:false,isLimitReached:false,textStatus:null,lengthText:0,keyDownPresent:false,click:false,eventPresent:"keydown",eventPrevent:null,falsePositive:false,checkFirstKeyDown:false,continueKeyCheck:true,selectBeforeKeydown:false,supportsInput:null},removeDataStore:function(e){this.dataStore[e]=null},setDataStore:function(e,t){this.dataStore[e]=t},copyObjectValue:function(e,t,n){for(var r in e){if(e.hasOwnProperty(r)){if(n===r){t[n]=e[n]}}}},negateEvent:function(e){e.preventDefault();e.stopPropagation()},isTextSelected:function(e){if(Math.abs(e.start-e.end)>0){return true}},setSelectionStatus:function(){var e=this.dataStore;e.caretStatus=i.getInputSelection();if(i.isTextSelected(e.caretStatus)){this.setDataStore("isTextSelected",true)}else{this.setDataStore("isTextSelected",false)}},trackSelectionFunction:function(){var e=i.dataStore.isTextSelected;i.setSelectionStatus();var n=i.dataStore.isTextSelected;if(e&&n===false){t.trigger("stopVerbosity-deselect")}},getText:function(){return t.val()},getTextAreaLength:function(){return this.getText().length},checkLimit:function(e){var t=this.getTextAreaLength();if(t>e){return"greater"}else if(t===e){return"equal"}else if(t<e){return"less"}},setInputSelection:function(e,n){var r=this.setInputSelection;var i=t[0];if(typeof i.selectionStart==="number"&&typeof i.selectionEnd==="number"){i.selectionStart=e;i.selectionEnd=n}else{var s=i.createTextRange();var o=r.offsetToRangeCharacterMove(i,e);s.collapse(true);if(e===n){s.move("character",o)}else{s.moveEnd("character",r.offsetToRangeCharacterMove(i,n));s.moveStart("character",o)}s.select()}},getInputSelection:function(){var e=0,r=0,i,s,o,u,a,f=t[0];if(typeof f.selectionStart==="number"&&typeof f.selectionEnd==="number"){e=f.selectionStart;r=f.selectionEnd}else{s=n.selection.createRange();if(s&&s.parentElement()===f){u=f.value.length;i=f.value.replace(/\r\n/g,"\n");o=f.createTextRange();o.moveToBookmark(s.getBookmark());a=f.createTextRange();a.collapse(false);if(o.compareEndPoints("StartToEnd",a)>-1){e=r=u}else{e=-o.moveStart("character",-u);e+=i.slice(0,e).split("\n").length-1;if(o.compareEndPoints("EndToEnd",a)>-1){r=u}else{r=-o.moveEnd("character",-u);r+=i.slice(0,r).split("\n").length-1}}}}return{start:e,end:r}}};return r.prototype}};s(t,r);s.prototype.init()};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new s(this,t))}})}})(jQuery,window,document)
