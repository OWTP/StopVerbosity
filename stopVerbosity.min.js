(function(e,t,n,r){"use strict";function o(t,n){this.element=t;this.options=e.extend({},s,n);this._defaults=s;this._name=i;this.init()}var i="stopVerbosity",s={limit:300,indicatorPosition:"after",indicatorId:"countdown-indicator",indicatorElementType:"p",indicatorPhrase:["Used","[countup]","of","[limit]","characters.","[countdown]","characters remaining.","The maximum is","[limit]","characters.","</br>","Permits multiple counts up:","[countup]","and counts down:","[countdown]",".","This indicator is customizable."],existingIndicator:"",generateIndicator:true,showIndicator:true,useNativeMaxlength:true};o.prototype={init:function(){var t=o.prototype,n=this.options,r=e(this.element),i=n.limit;var s=t.setupActions().init(r,n);t.eventsActions(r).init(i,s)},setupActions:function(){var t=function(){};t.prototype={init:function(e,n){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e,t){if(this==null){throw new TypeError}var n=Object(this);var r=n.length>>>0;if(r===0){return-1}var i=0;if(arguments.length>1){i=Number(arguments[1]);if(i!=i){i=0}else if(i!=0&&i!=Infinity&&i!=-Infinity){i=(i>0||-1)*Math.floor(Math.abs(i))}}if(i>=r){return-1}var s=i>=0?i:Math.max(r-Math.abs(i),0);for(;s<r;s++){if(s in n&&n[s]===e){return s}}return-1}}e.val("");var r=n.limit,i=n.indicatorPosition,s=n.indicatorId,o=n.indicatorElementType,u=n.indicatorPhrase,a=n.existingIndicator,f=n.generateIndicator,l=n.showIndicator,c=n.useNativeMaxlength;var h=t.prototype;h.setupDataStore.useNativeMaxlength=c;h.checkLimitOption(r);h.setIndicator(r,o,s,i,u,e,a,f,l);return h.setupDataStore},checkLimitOption:function(e){if(typeof e!=="number"){throw"Text limit is not a number."}},setIndicator:function(t,n,r,i,s,o,u,a,f){function c(e,t,n,r){var i=n.indexOf(t);while(i!==-1){r.setupDataStore[e].push(i);i=n.indexOf(t,i+1)}}function h(e,t,n){var r=n.setupDataStore[e],i=r.length,s=0;for(;s<i;s++){var o=r[s];switch(e){case"countup":t[o]=0;break;default:t.phrase[o]=t.limit;break}}}if(!f){return}var l=this;c("limit","[limit]",s,l);c("countup","[countup]",s,l);c("countdown","[countdown]",s,l);var p={phrase:s,limit:t};h("limit",p,l);h("countup",s,l);h("countdown",p,l);this.setupDataStore.indicatorPhrase=s;if(Object.prototype.toString.call(u)==="[object String]"){{try{var d=e(u);if(d.length){this.setupDataStore.indicatorElement=d;d.html(s.join(" "));a=false}}catch(v){throw"Indicator element not found."}}}if(a){var m;if(r.length>0){m=" id="+r}else{m=""}var g=["<",n,m,">",s.join(" "),"</",n,">"].join(""),y=["Not a valid position for indicator,","only accepts ","'before'"," or ","'after'"].join("");if(i==="after"){o.after(g);this.setupDataStore.indicatorElement=o.next()}else if(i==="before"){o.before(g);this.setupDataStore.indicatorElement=o.prev()}else{throw y}}},setupDataStore:{limit:[],countup:[],countdown:[]}};return t.prototype},eventsActions:function(t){var r=function(){},i=r.prototype={init:function(e,t){i.addListeners(e,t)},addListeners:function(e,r){var s=this.dataStore;s.eP=i;s.el=t;s.limit=e;s.indicator=r;var o={preventFunction:function(){var e=s.eventPrevent.indexOf("keydown");if(e===-1&&!s.isTextSelected){i.setDataStore("eventPrevent","keydown");i.removeDataStore("eventPresent","keydown");t.off("keydown");i.keydownFunction.keydownPrevent();i.pastePreventFunction(t,i)}},allowFunction:function(){var e=s.eventPrevent.indexOf("keydown");if(e>-1){i.removeDataStore("eventPrevent","keydown");i.setDataStore("eventPresent","keydown");t.off("keydown");t.off("paste");i.keydownFunction(t,i)}},changeText:function(n){var r=s.indicator,o=r[n];if(typeof o!=="undefined"){if(o.length){var u=null;if(n==="countdown"){u=e-i.getTextAreaLength(t)}else if(n==="countup"){u=i.getTextAreaLength(t)}var a=r[n],f=a.length,l=0;for(;l<f;l++){r.indicatorPhrase[a[l]]=u;var c=r.indicatorPhrase;r.indicatorElement.html(c.join(" "))}}}}};var u=n.createElement("textarea"),a;if("oninput"in u){s.partialInputSupport=true;if(!("documentMode"in n)||n.documentMode>9){a=false;s.supportsInput=true;s.partialInputSupport=false}}else if("onpropertychange"in u){a=true;s.supportsInput=false}s.checkFirstKeyDown=a;if(!!("maxLength"in u)){if(r.useNativeMaxlength){t.attr("maxlength",e)}}i.setInputSelection.offsetToRangeCharacterMove=function(e,t){return t-(e.value.slice(0,t).split("\r\n").length-1)};i.deselectFunction(o);i.selectFunction(o);i.dropFunction();i.inputFunction(o);i.trackSelectionEventsFunction();i.mousedownFunction();i.clickFunction();i.keydownFunction()},inputFunction:function(r){var s=i.dataStore;t.on("input propertychange",function(){s.checkFirstKeyDown=false;if(i.dataStore.dropOccurred){i.dataStore.dropOccurred=false;return}var e=s.limit,n=i.checkLimit(t,e);i.setDataStore("textStatus",n);if(n==="less"){if(s.falsePositive){r.allowFunction()}r.changeText("countdown");r.changeText("countup");i.setDataStore("lengthText",i.getTextAreaLength(t));setTimeout(function(){i.trackSelectionFunction(t,i)})}else if(n==="equal"){if(s.falsePositive){r.preventFunction()}r.changeText("countdown");r.changeText("countup");i.setDataStore("lengthText",i.getTextAreaLength(t));setTimeout(function(){i.trackSelectionFunction(t,i);if(s.falsePositive){if(typeof i.dataStore.newCaretPos==="number"){var e=i.dataStore.newCaretPos;i.setInputSelection(t,e,e);i.dataStore.newCaretPos=null}}})}else if(n==="greater"){s.falsePositive=true;if(s.selectBeforeKeydown){s.caretStatus=s.selectCaretStatus}var o=i.getTextAreaLength(t),u=s.caretStatus,a=u.start,f=u.end,l=s.lengthText,c=e-l,h=i.getText(t);var p,d,v,m;if(s.isTextSelected||s.selectBeforeKeydown){p=u.end;v=u.end;m=c+f;d=o-(l-f)}else{p=a;v=a;m=c+a;d=o-(l-a)}var g=h.slice(0,p),y=h.slice(v,m),b=h.slice(d,o),w=g+y+b,E=g.length+y.length;s.newCaretPos=E;if(w.length<=e){t.val(w);t.trigger("propertychange")}}});if(s.partialInputSupport){e(n).on("selectionchange",function(){if(i.getTextAreaLength(t)<s.lengthText){t.trigger("propertychange")}})}},dropFunction:function(){var e=i.dataStore;t.on("drop",function(){i.dataStore.dropOccurred=true;setTimeout(function(){i.trackSelectionFunction(t,i);var n=e.caretStatus,r=n.start,s=n.end,o;if(r!==s){e.caretStatus.start=r;e.caretStatus.end=r;o=s}else{var u=e.lengthText,a=t.val().length-u,f=r-a;e.caretStatus.start=f;e.caretStatus.end=f;o=r}i.setInputSelection(t,o,o);i.dataStore.dropOccurred=false;t.trigger("input")})})},pastePreventFunction:function(){t.on("paste",function(e){i.negateEvent(e)})},deselectFunction:function(e){t.on("deselect",function(){var n=i.dataStore.limit,r=i.checkLimit(t,n);i.trackSelectionFunction(t,i);if(r==="equal"){e.preventFunction()}else if(r==="greater"){t.trigger("propertychange")}})},selectFunction:function(e){t.on("select",function(){if(i.dataStore.dropOccurred){return}i.trackSelectionFunction(t,i);var n=i.dataStore.caretStatus,r=i.dataStore.limit,s=i.checkLimit(t,r);var o=n.start,u=n.end,a=i.dataStore.selectCaretStatus;a.start=o;a.end=u;if(s==="equal"){if(n.end===n.start){e.preventFunction()}else{e.allowFunction()}}})},trackSelectionEventsFunction:function(){t.on("mouseout focus blur",function(){setTimeout(function(){i.trackSelectionFunction(t,i)})})},mousedownFunction:function(){t.on("mousedown",function(){i.setDataStore("isMouseDown",true)})},clickFunction:function(){t.on("click",function(){setTimeout(function(){i.trackSelectionFunction(t,i)});i.setDataStore("isMouseDown",false)})},keydownFunction:function(){var e=i.dataStore;this.keydownFunction.checkFirstKeyDown=function(n){if(e.checkFirstKeyDown){if(e.continueKeyCheck){setTimeout(function(){if(i.getTextAreaLength(t)>0){t.trigger("propertychange")}})}}if(n==="keyprevent"){setTimeout(function(){t.trigger("propertychange")})}};this.keydownFunction.checkTab=function(e){if(e.which===9){if(i.dataStore.isMouseDown){i.negateEvent(e);return true}}};this.keydownFunction.keydownPrevent=function(){t.on("keydown",function(n){if(/^(0|8|9|16|17|18|19|20|27|33|34|35|36|37|38|38|39|40|45|46|112|113|114|115|116|117|118|119|120|121|122|123)$/.test(n.which)){i.keydownFunction.checkTab(n);i.keydownFunction.checkFirstKeyDown("keyprevent");e.falsePositive=true}else if(n.ctrlKey===false){n.preventDefault()}setTimeout(function(){i.trackSelectionFunction(t,i);if(i.dataStore.isTextSelected){i.dataStore.selectBeforeKeydown=true}else{i.dataStore.selectBeforeKeydown=false}})})};t.off("keydown");t.on("keydown",function(e){i.keydownFunction.checkTab(e);i.keydownFunction.checkFirstKeyDown();setTimeout(function(){i.trackSelectionFunction(t,i);if(i.dataStore.isTextSelected){i.dataStore.selectBeforeKeydown=true}else{i.dataStore.selectBeforeKeydown=false}})})},dataStore:{newCaretPos:null,caretStatus:{start:0,end:0},selectCaretStatus:{start:0,end:0},dropOccurred:false,isMouseDown:false,isTextSelected:false,isLimitReached:false,textStatus:null,lengthText:0,keyDownPresent:false,click:false,eventPresent:["keydown"],eventPrevent:[],falsePositive:false,checkFirstKeyDown:false,continueKeyCheck:true,selectBeforeKeydown:false,supportsInput:null},removeDataStore:function(e,t){var n=this.dataStore[e],r=n.indexOf(t);n.splice(r,1)},setDataStore:function(e,t){if(this.dataStore[e]instanceof Array){this.dataStore[e].push(t)}else{this.dataStore[e]=t}},negateEvent:function(e){e.preventDefault();e.stopPropagation()},isTextSelected:function(e){if(Math.abs(e.start-e.end)>0){return true}},setSelectionStatus:function(){var e=this.dataStore;e.caretStatus=e.eP.getInputSelection(e.el);if(e.eP.isTextSelected(e.caretStatus)){this.setDataStore("isTextSelected",true)}else{this.setDataStore("isTextSelected",false)}},trackSelectionFunction:function(e,t){var n=t.dataStore.isTextSelected;t.setSelectionStatus();var r=t.dataStore.isTextSelected;if(n&&r===false){e.trigger("deselect")}},getText:function(e){return e.val()},getTextAreaLength:function(e){return this.getText(e).length},checkLimit:function(e,t){var n=this.getTextAreaLength(e);if(n>t){return"greater"}else if(n===t){return"equal"}else if(n<t){return"less"}},setInputSelection:function(e,t,n){var r=this.setInputSelection;var i=e[0];if(typeof i.selectionStart==="number"&&typeof i.selectionEnd==="number"){i.selectionStart=t;i.selectionEnd=n}else{var s=i.createTextRange();var o=r.offsetToRangeCharacterMove(i,t);s.collapse(true);if(t===n){s.move("character",o)}else{s.moveEnd("character",r.offsetToRangeCharacterMove(i,n));s.moveStart("character",o)}s.select()}},getInputSelection:function(e){var t=0,r=0,i,s,o,u,a,f=e[0];if(typeof f.selectionStart==="number"&&typeof f.selectionEnd==="number"){t=f.selectionStart;r=f.selectionEnd}else{s=n.selection.createRange();if(s&&s.parentElement()===f){u=f.value.length;i=f.value.replace(/\r\n/g,"\n");o=f.createTextRange();o.moveToBookmark(s.getBookmark());a=f.createTextRange();a.collapse(false);if(o.compareEndPoints("StartToEnd",a)>-1){t=r=u}else{t=-o.moveStart("character",-u);t+=i.slice(0,t).split("\n").length-1;if(o.compareEndPoints("EndToEnd",a)>-1){r=u}else{r=-o.moveEnd("character",-u);r+=i.slice(0,r).split("\n").length-1}}}}return{start:t,end:r}}};return r.prototype}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}})}})(jQuery,window,document)
