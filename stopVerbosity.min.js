(function(e,t,n,r){"use strict";function o(t,n){this.element=t;this.options=e.extend({},s,n);this._defaults=s;this._name=i;this.init()}var i="stopVerbosity",s={limit:300,indicatorPosition:"after",indicatorId:"countdown-indicator",indicatorElementType:"p",indicatorPhrase:["Used","[countup]","of","[limit]","characters.","[countdown]","characters remaining."],customIndicator:"",generateIndicator:true};o.prototype={init:function(){var t=o.prototype,n=this.options,r=e(this.element),i=n.limit;var s=t.setupActions().init(r,n);t.eventsActions().init(r,i,s)},setupActions:function(){var t=function(){};t.prototype={init:function(e,n){e.val("");var r=n.limit,i=n.indicatorPosition,s=n.indicatorId,o=n.indicatorElementType,u=n.indicatorPhrase,a=n.customIndicator,f=n.generateIndicator;var l=t.prototype;l.checkLimitOption(r);l.setIndicator(r,o,s,i,u,e,a,f);return l.setupDataStore},checkLimitOption:function(e){if(typeof e!=="number"){throw"Text limit is not a number."}},setIndicator:function(t,n,r,i,s,o,u,a){function l(e,t,n,r){var i=n.indexOf(t);if(i>-1){r.setupDataStore[e].push(i)}}var f=this;l("limit","[limit]",s,f);l("countup","[countup]",s,f);l("countdown","[countdown]",s,f);s[this.setupDataStore.limit]=t;s[this.setupDataStore.countup]=0;s[this.setupDataStore.countdown]=t;this.setupDataStore.indicatorPhrase=s;if(Object.prototype.toString.call(u)==="[object String]"){{try{var c=e(u);if(c.length){this.setupDataStore.indicatorElement=c;c.html(s.join(" "));a=false}}catch(h){throw"Indicator element not found."}}}if(a){var p=["<",n," id=",r,">",s.join(" "),"</",n,">"].join(""),d=["Not a valid position for indicator,","only accepts ","'before'"," or ","'after'"].join("");if(i==="after"){o.after(p);this.setupDataStore.indicatorElement=o.next()}else if(i==="before"){o.before(p);this.setupDataStore.indicatorElement=o.prev()}else{throw d}}},setupDataStore:{limit:[],countup:[],countdown:[]}};return t.prototype},eventsActions:function(){var e=function(){};e.prototype={init:function(t,n,r){var i=e.prototype;i.addListeners(t,n,i,r)},addListeners:function(e,t,n,r){var i=this.dataStore;i.eP=n;i.el=e;i.limit=t;i.indicator=r;var s={preventFunction:function(){var t=n.dataStore.eventPrevent.indexOf("keydown");if(t===-1){n.setDataStore("eventPrevent","keydown");n.removeDataStore("eventPresent","keydown");e.off("keydown");n.keydownFunction.keydownPrevent(e);n.pastePreventFunction(e,n)}},allowFunction:function(){var t=n.dataStore.eventPrevent.indexOf("keydown");if(t>-1){n.removeDataStore("eventPrevent","keydown");n.setDataStore("eventPresent","keydown");e.off("keydown").off("paste");n.keydownFunction(e,n)}},changeText:function(r){var i=n.dataStore.indicator,s=i[r];if(typeof s!=="undefined"){if(s.length){var o=null;if(r==="countdown"){o=t-n.getTextAreaLength(e)}else if(r==="countup"){o=n.getTextAreaLength(e)}var u=i[r][0];i.indicatorPhrase[u]=o;var a=i.indicatorPhrase;i.indicatorElement.html(a.join(" "))}}}};this.deselectFunction(e,n,s);this.selectFunction(e,n,s);this.inputFunction(e,n,s);this.focusFunction(e,n);this.blurFunction(e,n);this.mouseoutFunction(e,n);this.mousedownFunction(e,n);this.clickFunction(e,n);this.keydownFunction(e,n);this.setInputSelection.offsetToRangeCharacterMove=function(e,t){return t-(e.value.slice(0,t).split("\r\n").length-1)}},inputFunction:function(e,t,n){e.on("input propertychange",function(){var r=t.dataStore.limit;var i=t.checkLimit(e,r);t.setDataStore("textStatus",i);if(i==="less"){n.allowFunction();n.changeText("countdown");n.changeText("countup");t.setDataStore("lengthText",t.getTextAreaLength(e));setTimeout(function(){t.trackSelectionFunction(e,t)})}else if(i==="equal"){n.preventFunction();n.changeText("countdown");n.changeText("countup");t.setDataStore("lengthText",t.getTextAreaLength(e));setTimeout(function(){t.trackSelectionFunction(e,t);if(typeof t.dataStore.newCaretPos==="number"){var n=t.dataStore.newCaretPos;t.setInputSelection(e,n,n);t.dataStore.newCaretPos=null}})}else if(i==="greater"){var s=t.dataStore,o=t.getTextAreaLength(e),u=s.caretStatus,a=u.start,f=u.end,l=s.lengthText,c=r-l,h=t.getText(e);var p,d,v,m;if(t.dataStore.isTextSelected){p=u.end;v=u.end;m=c+f;d=o-(l-f)}else{p=a;v=a;m=c+a;d=o-(l-a)}var g=h.slice(0,p),y=h.slice(v,m),b=h.slice(d,o),w=g+y+b,E=g.length+y.length;t.dataStore.newCaretPos=E;e.val(w);e.trigger("input")}})},pastePreventFunction:function(e,t){e.on("paste",function(e){t.negateEvent(e)})},deselectFunction:function(e,t,n){e.on("deselect",function(){var r=t.dataStore.limit,i=t.checkLimit(e,r);if(i==="equal"){n.preventFunction()}})},selectFunction:function(e,t,n){e.on("select",function(){t.trackSelectionFunction(e,t);var r=t.dataStore.caretStatus,i=t.dataStore.limit,s=t.checkLimit(e,i);if(s==="equal"){if(r.end===r.start){n.preventFunction()}else{n.allowFunction()}}})},mouseoutFunction:function(e,t){e.on("mouseup",function(){setTimeout(function(){t.trackSelectionFunction(e,t)})})},mousedownFunction:function(e,t){e.on("mousedown",function(){t.setDataStore("isMouseDown",true)})},clickFunction:function(e,t){e.on("click",function(){setTimeout(function(){t.trackSelectionFunction(e,t)});t.setDataStore("isMouseDown",false)})},focusFunction:function(e,t){e.on("focus",function(){setTimeout(function(){t.trackSelectionFunction(e,t)})})},blurFunction:function(e,t){e.on("blur",function(){setTimeout(function(){t.trackSelectionFunction(e,t)})})},keydownFunction:function(e,t){this.keydownFunction.checkTab=function(e){if(e.which===9){if(t.dataStore.isMouseDown){t.negateEvent(e);return true}}};this.keydownFunction.keydownPrevent=function(e){e.on("keydown",function(n){if(/^(0|8|9|16|17|18|19|20|27|33|34|35|36|37|38|38|40|45|46|112|113|114|115|116|117|118|119|120|121|122|123)$/.test(n.which)){t.keydownFunction.checkTab(n)}else if(n.ctrlKey===false){n.preventDefault()}setTimeout(function(){t.trackSelectionFunction(e,t)})})};e.on("keydown",function(n){t.keydownFunction.checkTab(n);setTimeout(function(){t.trackSelectionFunction(e,t)})})},dataStore:{newCaretPos:null,caretStatus:null,isMouseDown:false,isTextSelected:false,isLimitReached:false,textStatus:null,lengthText:0,keyDownPresent:false,negotiateStatus:{},click:false,eventPresent:["keydown"],eventPrevent:[]},removeDataStore:function(e,t){var n=this.dataStore[e],r=n.indexOf(t);n.splice(r,1)},setDataStore:function(e,t){if(this.dataStore[e]instanceof Array){this.dataStore[e].push(t)}else{this.dataStore[e]=t}},negateEvent:function(e){e.preventDefault();e.stopPropagation()},isTextSelected:function(e){if(Math.abs(e.start-e.end)>0){return true}},setSelectionStatus:function(){var e=this.dataStore;e.caretStatus=e.eP.getInputSelection(e.el);if(e.eP.isTextSelected(e.caretStatus)){this.setDataStore("isTextSelected",true)}else{this.setDataStore("isTextSelected",false)}},trackSelectionFunction:function(e,t){var n=t.dataStore.isTextSelected;t.setSelectionStatus();var r=t.dataStore.isTextSelected;if(n&&r===false){e.trigger("deselect")}},getText:function(e){return e.val()},getTextAreaLength:function(e){return this.getText(e).length},checkLimit:function(e,t){var n=this.getTextAreaLength(e);if(n>t){return"greater"}else if(n===t){return"equal"}else if(n<t){return"less"}},setInputSelection:function(e,t,n){var r=this.setInputSelection;var i=e[0];if(typeof i.selectionStart==="number"&&typeof i.selectionEnd==="number"){i.selectionStart=t;i.selectionEnd=n}else{var s=i.createTextRange();var o=r.offsetToRangeCharacterMove(i,t);s.collapse(true);if(t===n){s.move("character",o)}else{s.moveEnd("character",r.offsetToRangeCharacterMove(i,n));s.moveStart("character",o)}s.select()}},getInputSelection:function(e){var t=0,r=0,i,s,o,u,a,f=e[0];if(typeof f.selectionStart==="number"&&typeof f.selectionEnd==="number"){t=f.selectionStart;r=f.selectionEnd}else{s=n.selection.createRange();if(s&&s.parentElement()===f){u=f.value.length;i=f.value.replace(/\r\n/g,"\n");o=f.createTextRange();o.moveToBookmark(s.getBookmark());a=f.createTextRange();a.collapse(false);if(o.compareEndPoints("StartToEnd",a)>-1){t=r=u}else{t=-o.moveStart("character",-u);t+=i.slice(0,t).split("\n").length-1;if(o.compareEndPoints("EndToEnd",a)>-1){r=u}else{r=-o.moveEnd("character",-u);r+=i.slice(0,r).split("\n").length-1}}}}return{start:t,end:r}}};return e.prototype}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}})}})(jQuery,window,document)
